<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 900 650">
  <defs>
    <linearGradient id="controlPlaneGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#E8F4FD"/>
      <stop offset="100%" style="stop-color:#D1E9FB"/>
    </linearGradient>
    <linearGradient id="dataPlaneGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#FDF4E8"/>
      <stop offset="100%" style="stop-color:#FBECD1"/>
    </linearGradient>
    <linearGradient id="boxGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#FFFFFF"/>
      <stop offset="100%" style="stop-color:#F8F9FA"/>
    </linearGradient>
    <filter id="shadow" x="-20%" y="-20%" width="140%" height="140%">
      <feDropShadow dx="2" dy="2" stdDeviation="3" flood-opacity="0.15"/>
    </filter>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#5C6BC0"/>
    </marker>
  </defs>
  
  <!-- Background -->
  <rect width="900" height="650" fill="#FAFBFC"/>
  
  <!-- Title -->
  <text x="450" y="35" text-anchor="middle" font-family="Segoe UI, Arial" font-size="22" font-weight="600" fill="#1a1a2e">
    Workflow Orchestrator Architecture
  </text>
  
  <!-- Control Plane Box -->
  <rect x="30" y="55" width="840" height="330" rx="12" fill="url(#controlPlaneGrad)" stroke="#90CAF9" stroke-width="2"/>
  <text x="50" y="80" font-family="Segoe UI, Arial" font-size="14" font-weight="600" fill="#1565C0">CONTROL PLANE</text>
  
  <!-- API Gateway -->
  <rect x="60" y="100" width="150" height="70" rx="8" fill="url(#boxGrad)" stroke="#5C6BC0" stroke-width="2" filter="url(#shadow)"/>
  <text x="135" y="130" text-anchor="middle" font-family="Segoe UI, Arial" font-size="13" font-weight="600" fill="#333">API Gateway</text>
  <text x="135" y="150" text-anchor="middle" font-family="Segoe UI, Arial" font-size="11" fill="#666">REST / gRPC</text>
  
  <!-- Workflow Coordinator -->
  <rect x="250" y="100" width="170" height="70" rx="8" fill="url(#boxGrad)" stroke="#5C6BC0" stroke-width="2" filter="url(#shadow)"/>
  <text x="335" y="130" text-anchor="middle" font-family="Segoe UI, Arial" font-size="13" font-weight="600" fill="#333">Workflow</text>
  <text x="335" y="150" text-anchor="middle" font-family="Segoe UI, Arial" font-size="13" font-weight="600" fill="#333">Coordinator</text>
  
  <!-- Task Coordinator -->
  <rect x="460" y="100" width="150" height="70" rx="8" fill="url(#boxGrad)" stroke="#5C6BC0" stroke-width="2" filter="url(#shadow)"/>
  <text x="535" y="130" text-anchor="middle" font-family="Segoe UI, Arial" font-size="13" font-weight="600" fill="#333">Task</text>
  <text x="535" y="150" text-anchor="middle" font-family="Segoe UI, Arial" font-size="13" font-weight="600" fill="#333">Coordinator</text>
  
  <!-- Scheduler -->
  <rect x="650" y="100" width="150" height="70" rx="8" fill="url(#boxGrad)" stroke="#5C6BC0" stroke-width="2" filter="url(#shadow)"/>
  <text x="725" y="130" text-anchor="middle" font-family="Segoe UI, Arial" font-size="13" font-weight="600" fill="#333">Scheduler</text>
  <text x="725" y="150" text-anchor="middle" font-family="Segoe UI, Arial" font-size="11" fill="#666">Cron / Timer</text>
  
  <!-- Arrows between components -->
  <line x1="210" y1="135" x2="248" y2="135" stroke="#5C6BC0" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="420" y1="135" x2="458" y2="135" stroke="#5C6BC0" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="610" y1="135" x2="648" y2="135" stroke="#5C6BC0" stroke-width="2" marker-end="url(#arrowhead)"/>
  
  <!-- Recovery Engine -->
  <rect x="60" y="195" width="150" height="70" rx="8" fill="url(#boxGrad)" stroke="#E57373" stroke-width="2" filter="url(#shadow)"/>
  <text x="135" y="225" text-anchor="middle" font-family="Segoe UI, Arial" font-size="13" font-weight="600" fill="#333">Recovery</text>
  <text x="135" y="245" text-anchor="middle" font-family="Segoe UI, Arial" font-size="13" font-weight="600" fill="#333">Engine</text>
  
  <!-- Metrics -->
  <rect x="650" y="195" width="150" height="70" rx="8" fill="url(#boxGrad)" stroke="#81C784" stroke-width="2" filter="url(#shadow)"/>
  <text x="725" y="225" text-anchor="middle" font-family="Segoe UI, Arial" font-size="13" font-weight="600" fill="#333">Metrics</text>
  <text x="725" y="245" text-anchor="middle" font-family="Segoe UI, Arial" font-size="11" fill="#666">Prometheus</text>
  
  <!-- State Store (PostgreSQL) -->
  <rect x="250" y="195" width="360" height="90" rx="8" fill="url(#boxGrad)" stroke="#42A5F5" stroke-width="2" filter="url(#shadow)"/>
  <text x="430" y="220" text-anchor="middle" font-family="Segoe UI, Arial" font-size="14" font-weight="600" fill="#1565C0">PostgreSQL State Store</text>
  
  <!-- DB Tables -->
  <rect x="265" y="235" width="100" height="40" rx="4" fill="#E3F2FD" stroke="#90CAF9" stroke-width="1"/>
  <text x="315" y="260" text-anchor="middle" font-family="Consolas, monospace" font-size="10" fill="#333">workflow_instances</text>
  
  <rect x="375" y="235" width="100" height="40" rx="4" fill="#E3F2FD" stroke="#90CAF9" stroke-width="1"/>
  <text x="425" y="260" text-anchor="middle" font-family="Consolas, monospace" font-size="10" fill="#333">task_executions</text>
  
  <rect x="485" y="235" width="110" height="40" rx="4" fill="#E3F2FD" stroke="#90CAF9" stroke-width="1"/>
  <text x="540" y="260" text-anchor="middle" font-family="Consolas, monospace" font-size="10" fill="#333">execution_leases</text>
  
  <!-- Events (append-only) -->
  <rect x="250" y="295" width="360" height="40" rx="8" fill="#FFF3E0" stroke="#FFB74D" stroke-width="2" filter="url(#shadow)"/>
  <text x="430" y="320" text-anchor="middle" font-family="Segoe UI, Arial" font-size="12" font-weight="600" fill="#E65100">üìú Events (Append-Only Log)</text>
  
  <!-- Arrows to DB -->
  <line x1="335" y1="170" x2="380" y2="193" stroke="#5C6BC0" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="535" y1="170" x2="480" y2="193" stroke="#5C6BC0" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="135" y1="265" x2="248" y2="265" stroke="#E57373" stroke-width="2" marker-end="url(#arrowhead)"/>
  
  <!-- Task Queue -->
  <rect x="350" y="355" width="200" height="45" rx="8" fill="#F3E5F5" stroke="#AB47BC" stroke-width="2" filter="url(#shadow)"/>
  <text x="450" y="383" text-anchor="middle" font-family="Segoe UI, Arial" font-size="13" font-weight="600" fill="#6A1B9A">Task Queue (Kafka)</text>
  
  <!-- Arrow to Task Queue -->
  <line x1="450" y1="335" x2="450" y2="353" stroke="#AB47BC" stroke-width="2" marker-end="url(#arrowhead)"/>
  
  <!-- Data Plane Box -->
  <rect x="30" y="420" width="840" height="200" rx="12" fill="url(#dataPlaneGrad)" stroke="#FFB74D" stroke-width="2"/>
  <text x="50" y="445" font-family="Segoe UI, Arial" font-size="14" font-weight="600" fill="#E65100">DATA PLANE (Workers)</text>
  
  <!-- Arrow from Queue to Data Plane -->
  <line x1="450" y1="400" x2="450" y2="455" stroke="#AB47BC" stroke-width="3" marker-end="url(#arrowhead)"/>
  
  <!-- Worker 1 -->
  <rect x="60" y="465" width="180" height="130" rx="8" fill="url(#boxGrad)" stroke="#FF8A65" stroke-width="2" filter="url(#shadow)"/>
  <text x="150" y="490" text-anchor="middle" font-family="Segoe UI, Arial" font-size="13" font-weight="600" fill="#333">Worker Pool</text>
  <text x="150" y="508" text-anchor="middle" font-family="Segoe UI, Arial" font-size="11" fill="#BF360C">(Payments)</text>
  <rect x="75" y="520" width="150" height="65" rx="4" fill="#FFF8E1" stroke="#FFE082" stroke-width="1"/>
  <text x="150" y="540" text-anchor="middle" font-family="Consolas, monospace" font-size="10" fill="#555">1. Poll for task</text>
  <text x="150" y="555" text-anchor="middle" font-family="Consolas, monospace" font-size="10" fill="#555">2. Acquire lease</text>
  <text x="150" y="570" text-anchor="middle" font-family="Consolas, monospace" font-size="10" fill="#555">3. Execute + Heartbeat</text>
  
  <!-- Worker 2 -->
  <rect x="280" y="465" width="180" height="130" rx="8" fill="url(#boxGrad)" stroke="#FF8A65" stroke-width="2" filter="url(#shadow)"/>
  <text x="370" y="490" text-anchor="middle" font-family="Segoe UI, Arial" font-size="13" font-weight="600" fill="#333">Worker Pool</text>
  <text x="370" y="508" text-anchor="middle" font-family="Segoe UI, Arial" font-size="11" fill="#BF360C">(Shipping)</text>
  <rect x="295" y="520" width="150" height="65" rx="4" fill="#FFF8E1" stroke="#FFE082" stroke-width="1"/>
  <text x="370" y="540" text-anchor="middle" font-family="Consolas, monospace" font-size="10" fill="#555">1. Poll for task</text>
  <text x="370" y="555" text-anchor="middle" font-family="Consolas, monospace" font-size="10" fill="#555">2. Acquire lease</text>
  <text x="370" y="570" text-anchor="middle" font-family="Consolas, monospace" font-size="10" fill="#555">3. Execute + Heartbeat</text>
  
  <!-- Worker 3 -->
  <rect x="500" y="465" width="180" height="130" rx="8" fill="url(#boxGrad)" stroke="#FF8A65" stroke-width="2" filter="url(#shadow)"/>
  <text x="590" y="490" text-anchor="middle" font-family="Segoe UI, Arial" font-size="13" font-weight="600" fill="#333">Worker Pool</text>
  <text x="590" y="508" text-anchor="middle" font-family="Segoe UI, Arial" font-size="11" fill="#BF360C">(Inventory)</text>
  <rect x="515" y="520" width="150" height="65" rx="4" fill="#FFF8E1" stroke="#FFE082" stroke-width="1"/>
  <text x="590" y="540" text-anchor="middle" font-family="Consolas, monospace" font-size="10" fill="#555">1. Poll for task</text>
  <text x="590" y="555" text-anchor="middle" font-family="Consolas, monospace" font-size="10" fill="#555">2. Acquire lease</text>
  <text x="590" y="570" text-anchor="middle" font-family="Consolas, monospace" font-size="10" fill="#555">3. Execute + Heartbeat</text>
  
  <!-- Fence Token Highlight -->
  <rect x="720" y="465" width="140" height="130" rx="8" fill="#FFEBEE" stroke="#EF5350" stroke-width="2" filter="url(#shadow)"/>
  <text x="790" y="490" text-anchor="middle" font-family="Segoe UI, Arial" font-size="12" font-weight="600" fill="#C62828">üîê Exactly-Once</text>
  <text x="790" y="515" text-anchor="middle" font-family="Segoe UI, Arial" font-size="10" fill="#555">Fence Token</text>
  <text x="790" y="535" text-anchor="middle" font-family="Segoe UI, Arial" font-size="10" fill="#555">Validation</text>
  <line x1="750" y1="550" x2="830" y2="550" stroke="#EF5350" stroke-width="1"/>
  <text x="790" y="570" text-anchor="middle" font-family="Segoe UI, Arial" font-size="10" fill="#555">Idempotency Keys</text>
  <text x="790" y="585" text-anchor="middle" font-family="Segoe UI, Arial" font-size="10" fill="#555">Lease Expiry</text>
  
  <!-- Legend -->
  <rect x="680" y="55" width="180" height="35" rx="4" fill="white" stroke="#ccc" stroke-width="1"/>
  <circle cx="700" cy="72" r="6" fill="#5C6BC0"/>
  <text x="715" y="76" font-family="Segoe UI, Arial" font-size="10" fill="#333">Core Component</text>
  <circle cx="780" cy="72" r="6" fill="#E57373"/>
  <text x="795" y="76" font-family="Segoe UI, Arial" font-size="10" fill="#333">Recovery</text>
</svg>
